# Userbot для мониторинга Star Gifts

Этот userbot мониторит **ВСЕ чаты** на предмет Star Gifts и автоматически отправляет найденные подарки в Django API.

## Структура проекта

```
userbot/
├── __init__.py          # Инициализация пакета
├── main.py             # Основной файл запуска
├── config.py           # Конфигурация
├── telegram_client.py  # Работа с Telegram API
├── message_handler.py  # Обработка сообщений
├── gift_processor.py   # Обработка данных подарков
├── api_client.py       # Работа с Django API
├── requirements.txt    # Зависимости
└── Dockerfile         # Docker конфигурация
```

## Переменные окружения

```env
# Telegram API
API_ID=your_telegram_api_id
API_HASH=your_telegram_api_hash

# Авторизация (обязательно для первого запуска)
PHONE_NUMBER=+1234567890  # Ваш номер телефона в международном формате
LOGIN_CODE=12345          # Код из SMS (получите при первом запуске)

# Django API
API_BASE_URL=http://web:8000
API_TOKEN=your_django_api_token
USER_ID=1
```

## Первый запуск и авторизация

### Шаг 1: Подготовка
1. **Получите API ключи** на https://my.telegram.org/apps
2. **Установите переменные окружения** в `.env` файле:
   ```env
   API_ID=your_api_id
   API_HASH=your_api_hash
   PHONE_NUMBER=+1234567890  # Ваш номер в международном формате
   ```

### Шаг 2: Первая авторизация
1. **Запустите userbot** первый раз:
   ```bash
   python main.py
   ```
2. **Получите код из SMS** на ваш номер телефона
3. **Добавьте код в переменные окружения**:
   ```env
   LOGIN_CODE=12345  # Код из SMS
   ```
4. **Перезапустите userbot** - он автоматически авторизуется

### Шаг 3: Последующие запуски
- **Сессия сохранится** в файле `session/userbot.session`
- **Авторизация больше не потребуется** при следующих запусках
- **Просто запускайте** `python main.py`

## Устранение проблем

### Код авторизации истек или неверный
1. **Удалите файл сессии**: `rm session/userbot.session`
2. **Обновите код**: установите новую переменную `LOGIN_CODE`
3. **Перезапустите userbot**

### Требуется двухфакторная аутентификация
- **Отключите 2FA** в настройках Telegram
- Или добавьте поддержку пароля в код (требует доработки)

### Ошибки подключения
- **Проверьте интернет-соединение**
- **Убедитесь в правильности API_ID и API_HASH**
- **Проверьте формат номера телефона** (+1234567890)

## Запуск

```bash
python main.py
```

## Docker

```bash
docker-compose up userbot
```
